#!/usr/bin/env ruby
# -*- encoding: utf-8 -*-

# begin
require 'gherkify'
# rescue LoadError
#   lib = File.expand_path('../../lib', __FILE__)
#   $LOAD_PATH.unshift(lib) unless $LOAD_PATH.include?(lib)
#   require 'gherkify'
# end

require 'slop'
require 'awesome_print'

def main
  opts = Slop.parse(help: true) do
    banner 'Usage: gherkify path [options]'
    on 'd', 'dir', 'Output directory', argument: :optional
  end

  path = ARGV[0]
  puts opts.help if path.nil?
  return if path.nil?

  output_dir = (opts.dir?) ? opts[:dir] : '.'

  if File.directory? path
    files = Dir.glob(File.join(path, "*.feature"))
  else
    files = [path]
  end

  gherkify = Gherkify.parse_files(files, {output_dir: output_dir})
  # gherkify.fetch_diagram_images
  # puts gherkify.to_md('index.md')
  puts gherkify.to_s
    

end





# url: http://yuml.me/diagram/scruffy;scale:80;/class/
# params: dsl_text = [Customer]->[Billing Address]

main